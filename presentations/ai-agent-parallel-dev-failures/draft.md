# AIエージェント並列開発の失敗体験と学び - ストーリー下書き

## 発表の流れ（5分）

### 1. タイトル（10秒）
- タイトル表示
- AI駆動開発勉強会

### 2. 自己紹介（20秒）
- 株式会社ZENE / テックリード
- ゲノム解析ワークフロー・WEBアプリケーション開発
  - 遺伝子診断システムの構築
  - ゲノム情報 = 要配慮個人情報
  - セキュアな環境での開発が必須
- なぜこの話をするか
  - セキュリティ重視の環境でAIエージェントを活用
  - 23andMeの個人情報流出事例（チャプター11申請）
  - セキュアな環境ゆえレビューコストが高い
  - 「AIの便利さ」と「情報セキュリティ」のバランスを模索

### 3. 今回のチャレンジ（30秒）
- **開発対象**
  - ToB向けの解析レポート管理WEBアプリケーション
  - Next.js + AWSサーバレス構成
  - [図：システム構成図 - Next.js, AppRunner, Aurora Serverless, Cognito, S3]
  
- **エージェント構成**
  - リーダー × 1：全体のオーケストレーション担当
  - ワーカー × 3：各機能の実装担当
  - 並列実行による開発スピード向上を期待

- **開発フローのイメージ**
  - [図：開発フロー図]
  - リーダーが要件定義→基本設計→タスク分割（直列）
  - 実装フェーズで各タスクをワーカーに振り分け（並列）
  - ワーカーが並列で実装・PR作成
  - 人間がレビュー→OKならリーダーがコンフリクト解消・マージ
  - タスクが無くなるまで並列実装を継続
  - 今回話す内容は並列実装の部部についての話（要件定義・設計の後、結合テストの前）
  
- **期待していた効果**
  - レビュー中も裏で次の実装が進む並列処理
  - 自動的なタスク分割（統合は多少人の手が必要と想定）
  - きれいに並列で進められる効率的な開発

### 4. 期待と現実のギャップ（40秒）
- **期待の詳細**
  - 2-3回のやりとりでタスク完了
  - 待ち時間なしのスムーズな並列実行
  - [図：理想の並列フロー - レビューと実装が並行して進む様子]
- **実際に起きたこと**
  - ジュニアエンジニア3人分のレビュー地獄
  - 5-10回のやりとりで気力枯渇
  - ビッグバンPR（1000行以上）の量産
  - 実質的に直列処理に退化
  - [図：現実の直列フロー - 待機とブロックが頻発する様子]

### 5. 何が起きたか：記憶喪失による混乱（50秒）
- **コンテキストウィンドウの限界**
  - 想定より早くコンテキスト上限に到達
  - Auto Compactによる記憶喪失が頻発
  - 設計と実装にズレが発生
- **連鎖的なカオス**
  - 後続エージェントが間違った前提で実装
  - エラー修正も表面的な対処のみ
  - 根本原因が解決されず技術的負債が急速に蓄積
- **結果**
  - プロトタイプなのに負債まみれ
  - 手動でほぼ作り直し

### 6. 何が起きたか（50秒）
- **エージェントの暴走**
  - スコープクリープ（勝手に機能追加）
  - 依存関係を無視した先行実装
  - 開発原則を無視しがち（YAGNI、DRY、KISS違反など）
    - 不要なメソッドを実装して使わない
    - 同じような処理を重複して定義
- **人間側のボトルネック**
  - 過度なレビューやコンテキストスイッチにより精神的に疲弊
  - 自分でコードを書いていないので実装について忘れがち
  - 不慣れな領域では学習も必要
- **コア機能での限界**
  - ビジネスクリティカルな部分は任せられない
  - セキュリティ面での責任が持てない

### 7. うまくいった部分もある（30秒）
- **AIが得意な領域**
  - 非コア機能では十分な品質、特にUIやデザインは私よりもうまく実装できている
  - 動くものはなんだかんだ速くできる（バグも多いが）
- **改善の可能性**
  - E2Eテストを最初に作っておけば品質担保できた
  - 非コア機能の実装はDevin等に投げるのもあり

### 8. 改善アプローチ（検証中）（40秒）
- **まずは反省**
  - 直列で十分な品質を担保するワークフローの整備が不十分
  - 品質を上げる方向で並列にエージェントを動かすアプローチを試みた
- **品質向上のための並列化**
  - エージェント間のペアプロ
  - ドメイン/技術スペシャリストで役割分担
  - 別コンテキストで記憶喪失を防ぐ
- **人間のボトルネック解消**
  - 人間の処理能力を基準に並列度を調整
  - レビュー要約エージェントの追加

### 9. 改善アプローチの効果（30秒）
- **品質向上のための並列化の結果**
  - 体感的にコードの品質が向上
  - CodeRabbitや人間によるレビューのやりとりが半減
  - エージェント間の相互チェックが機能
  - タスクサイズを適切に保ち一度のPRの肥大化も防止
- **まだ課題はあるが方向性は正しい**
  - 完璧ではないが確実に改善
  - 継続的な調整で更なる向上を期待

### 10. 得られた教訓（30秒）
- **期待と現実のギャップ**
  - 並列開発で単純に速度が上がるわけではない
  - コンテキストウィンドウの限界で人が起こさないような問題も発生
- **学んだこと**
  - まずは直列でフローを整備することが重要
  - 基礎が固まってから並列化へ移行
  - 工夫次第で並列化のメリットを引き出す余地はありそう
- **人間の役割は変わらない**
  - 成果物の責任は結局人間が持つ
  - レビューとテストのコストは必須
  - 人間のボトルネックをベースにスケールすべき

### 11. まとめ：並列開発の新しい方向性（20秒）
- **現状うまくいっている並列実行のアプローチ**
  - 機能別/タスク別の並列ではなく、1つのタスクの品質・効率を上げる方向での並列化
  - 品質向上による人間のレビューコストや学習コストの軽減
- **今後の構想**
  - まず品質向上のためのエージェント協業を確立
  - その後、人間のボトルネックに合わせてスケール
  - なるべくコンフリクトしない形で拡張

## ポイント

- 具体的な失敗事例を通じて共感を得る
- 技術的な詳細は最小限に
- 解決策は実践的に
- 聴衆が明日から使える知見を提供

## 今回のチャレンジの詳細

### プロジェクト概要
- **目的**：ToB向け解析レポート管理システムのプロトタイプ開発
- **期間**：2週間でのMVP実装
- **技術スタック**：[図：Next.js, AppRunner, Aurora Serverless v2, Cognito, S3の構成図]

### AIエージェント構成
- **リーダーエージェント（×1）**
  - 役割：全体設計とタスク分割
  - オーケストレーション：各ワーカーへの指示出し
  - 統合：各ワーカーの成果物を結合
  
- **ワーカーエージェント（×3）**
  - 動的なタスク割り当て
  - 各ワーカーは特定領域に限定せず
  - リーダーが状況に応じて振り分け

### 期待していた開発フロー
1. 要件をリーダーエージェントに投入
2. リーダーがタスクを分割・依存関係を管理
3. 複数ワーカーが並列で実装開始
4. 人間のPRレビューと他ワーカーの実装が並列進行
5. 2-3回のやりとりでタスク完了・マージ
6. リーダーがコンフリクトを自動解消
7. 次のタスクへシームレスに移行

### 実際に起きた問題点

#### 1. 実装の暴走
- **ビッグバンPR**：1つのPRで1000行以上の変更
- **スコープクリープ**：指示以上の実装を勝手に進める
- **依存関係無視**：前提タスクの完了を待たずに先行実装

#### 2. 品質の問題
- **表面的なエラー修正**：根本原因を解決せず、さらにカオスに
- **技術的負債の急速な蓄積**：プロトタイプなのに負債まみれ
- **コンフリクト解消の失敗**：手動修正が頻発

#### 3. コンテキスト管理の崩壊
- **Auto Compactによる記憶喪失**：設計と実装にズレが生じる
- **後続エージェントの混乱**：どちらが正しいか分からないまま実装
- **情報の不整合**：カオスが連鎖的に拡大

#### 4. 人間側のボトルネック
- **レビュー地獄**：ジュニアエンジニア3人分のレビューが同時に来る感覚
- **気力の枯渇**：レビューの質が保てない
- **知識のキャッチアップ**：不慣れな領域では学習も必要でボトルネック化

#### 5. 並列実行の破綻
- **待機命令の頻発**：1エージェントずつ対応（実質直列）
- **レビューの長期化**：2-3回で終わらず5-10回のやりとり

### 実際に使用したツール
- Claude 3.5 Sonnet（リーダー）
- GPT-4（ワーカー1）
- Claude 3 Opus（ワーカー2）
- GitHub Copilot（ワーカー3）

### 振り返りと気づき

#### うまくいった部分
- **UI/デザイン実装**：AIの創造性が光る、人間より優れた部分も
- **非コア機能**：重要度が低い機能では十分な品質
- **初期プロトタイプ**：アイデアの具現化は速い

#### 改善の可能性があった点
- **E2Eテストの事前準備**：最初に作っておけば品質担保できた
- **適切なツール選択**：Devin等の専用ツールの方が向いていたかも
- **要件定義の方法**：独自の要件定義駆動で実施（Kiro登場前）

#### 根本的な課題
- **コア機能での責任**：ビジネスクリティカルな部分は任せられない
- **前提知識の差**：エージェントの知識レベルが開発品質に直結
- **人間の限界**：3人のジュニアエンジニアを同時に指導する感覚

### 改善アプローチ（検証中）

#### 1. 人間のボトルネック解消
- **スケール戦略**：人間の処理能力を基準に並列度を調整
- **サポートエージェントの追加**
  - レビュー要点の要約エージェント
  - 技術解説エージェント
  - キャッチアップ効率化

#### 2. 品質向上のための並列化
- **エージェント間のペアプロ**：実装エージェント同士で協業
- **役割分担の明確化**
  - ドメインスペシャリスト（業務知識）
  - 技術スペシャリスト（技術スタック）
  - 別々のコンテキストで記憶喪失を防ぐ

#### 3. 実装予定の改善策
- **段階的な並列度の調整**：人間の余力に応じて動的に変更
- **品質チェックの自動化**：エージェント間での相互レビュー
- **コンテキスト管理の改善**：専門性で分割して記憶を保持

## 自己紹介の詳細情報

### 所属・役職
- 株式会社ZENE
- ポジション：テックリード
- スタートアップ環境での開発

### 業務内容
- **ゲノム解析ワークフローシステム**
  - 大規模なゲノムデータの処理パイプライン
  - バイオインフォマティクス解析の自動化
  
- **遺伝子診断WEBアプリケーション**
  - 医療機関向けの診断支援システム
  - 患者向けレポート生成システム
  - リアルタイムデータ可視化

### セキュリティ環境の特殊性
- **ゲノム情報の取り扱い**
  - それ単体で要配慮個人情報
  - 個人識別性が永続的（変更不可能）
  - 血縁者への影響も考慮必要
  
- **業界の現状**
  - 23andMe（業界最大手）が個人情報流出
  - 690万人分のDNAプロファイル流出
  - チャプター11（連邦破産法第11章）申請
  - スタートアップにとっては一発アウトのリスク

### AIエージェント活用の背景
- **スタートアップの二重の制約**
  - セキュリティインシデント → 即アウト（信頼失墜・事業停止）
  - 開発スピードの停滞 → 徐々に体力削減（競争力低下・資金燃焼）
  - 「守り」と「攻め」の両立が生存条件
  
- **開発効率化の必要性**
  - 少人数での大規模システム開発
  - 専門知識（バイオインフォマティクス）と技術の融合
  - 競合他社との開発スピード競争
  
- **セキュリティとスピードのジレンマ**
  - 従来のセキュア開発：慎重だが遅い
  - AI活用開発：速いがリスクあり
  - 求められるのは「セキュアかつ高速」な第三の道

### 今回の発表の動機
- **両立は可能だが、落とし穴が多い**
  - AIエージェント並列化で速度を追求
  - セキュリティを犠牲にしない設計
  - 数々の失敗から学んだ実践的知見
- **同じ悩みを持つエンジニアへ**
  - 「速く」と「安全に」は二択ではない
  - 失敗パターンを知ることで回避可能
  - ベストプラクティスの共有
